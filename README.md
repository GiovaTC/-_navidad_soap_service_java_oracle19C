# -_navidad_soap_service_java_oracle19C :.

<img width="1536" height="1024" alt="image" src="https://github.com/user-attachments/assets/1c4f9837-d2e2-47bc-b957-4f357e20aebb" />     
     
# README -- Navidad SOAP Service (Java + Oracle 19c)

Este documento describe el servicio web SOAP **NavidadSoapService**,
implementado en Java (IntelliJ) y conectado a una base de datos Oracle
19c mediante JDBC. Incluye:

-   DTOs: `Customer`, `Gift`, `OrderDTO`\
-   DAO: `OracleDAO`\
-   Servicio SOAP: `NavidadService` + `NavidadServiceImpl`\
-   Publicador: `EndpointPublisher`\
-   Cliente de ejemplo: `NavidadClient`\
-   Script SQL para generar las tablas en Oracle\
-   Instrucciones para ejecuci√≥n en IntelliJ

------------------------------------------------------------------------

## üìå Descripci√≥n General

El archivo `NavidadSoapService.java` contiene **una implementaci√≥n
completa y en un solo archivo**, ideal para pruebas r√°pidas en
IntelliJ.\
Incluye operaciones CRUD para clientes y regalos, y creaci√≥n de √≥rdenes
con actualizaci√≥n de inventario.

------------------------------------------------------------------------

## üì¶ Estructura del Archivo

El archivo original contiene:

-   Declaraci√≥n de DTOs\
-   Implementaci√≥n del DAO con JDBC Oracle\
-   Servicio SOAP con JAX‚ÄëWS\
-   Implementaci√≥n del servicio\
-   Publicador local con `Endpoint.publish`\
-   Cliente SOAP funcional usando `Service.create`

------------------------------------------------------------------------

## üóÑ SQL -- Tablas Oracle 19c

Ejecutar en Oracle:

``` sql
CREATE TABLE CUSTOMER (
  CUSTOMER_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  NAME VARCHAR2(200),
  EMAIL VARCHAR2(200),
  CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
  PRIMARY KEY (CUSTOMER_ID)
);

CREATE TABLE GIFT (
  GIFT_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  NAME VARCHAR2(200),
  PRICE NUMBER(10,2),
  IN_STOCK NUMBER(10),
  PRIMARY KEY (GIFT_ID)
);

CREATE TABLE ORDERS (
  ORDER_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  CUSTOMER_ID NUMBER,
  GIFT_ID NUMBER,
  QUANTITY NUMBER,
  TOTAL_PRICE NUMBER(12,2),
  ORDER_DATE TIMESTAMP DEFAULT SYSTIMESTAMP,
  PRIMARY KEY (ORDER_ID),
  CONSTRAINT FK_ORDER_CUSTOMER FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
  CONSTRAINT FK_ORDER_GIFT FOREIGN KEY (GIFT_ID) REFERENCES GIFT(GIFT_ID)
);
```

------------------------------------------------------------------------

## üß© Dependencias Requeridas

Si usas **Java 8** ‚Üí JAX‚ÄëWS viene incluido.\
Si usas **Java 11+** ‚Üí debes agregar Metro (JAX‚ÄëWS RI):

``` xml
<dependency>
  <groupId>com.sun.xml.ws</groupId>
  <artifactId>rt</artifactId>
  <version>2.3.3</version>
</dependency>
```

Y agregar manualmente:

    ojdbc8.jar

------------------------------------------------------------------------
## üîß Ajustes Necesarios

En la clase `OracleDAO`, configura:

``` java
/*
 * NavidadSoapService.java
 * Single-file example SOAP web service + client + DAO for Oracle 19c
 * Designed to be opened in IntelliJ as a single-file demo project.
 *
 * Contiene:
 *  - DTOs: Customer, Gift, Order
 *  - DAO: OracleDAO (JDBC) para manipular la BD Oracle 19c
 *  - Servicio SOAP: NavidadService (interface) + NavidadServiceImpl
 *  - Publicador: EndpointPublisher (main para lanzar el servicio)
 *  - Cliente ejemplo: NavidadClient (consume el servicio publicado localmente)
 *
 * NOTAS IMPORTANTES:
 *  - A√±adir dependencias en el proyecto (Maven/Gradle o librer√≠as en classpath):
 *      * javax.jws (JAX-WS) -> normalmente disponible en Java SE 8 y algunos runtimes.
 *      * Metro (JAX-WS RI) si usas Java 11+: com.sun.xml.ws:rt
 *      * Oracle JDBC driver: ojdbc8.jar (o la versi√≥n que corresponda a tu Oracle 19c)
 *  - Ajusta la cadena de conexi√≥n en OracleDAO.CONNECTION_STRING, usuario y password.
 *  - Este archivo intenta ser did√°ctico y listo para correr en un entorno local,
 *    pero en producci√≥n debes separar en paquetes, manejar credenciales con m√°s seguridad,
 *    y usar un servidor de aplicaciones (Tomcat/GlassFish/JBoss) o un contenedor SOAP.
 *
 * SQL para crear tablas (ejecutar en Oracle 19c):
 *
 * CREATE TABLE CUSTOMER (
 *   CUSTOMER_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
 *   NAME VARCHAR2(200),
 *   EMAIL VARCHAR2(200),
 *   CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
 *   PRIMARY KEY (CUSTOMER_ID)
 * );
 *
 * CREATE TABLE GIFT (
 *   GIFT_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
 *   NAME VARCHAR2(200),
 *   PRICE NUMBER(10,2),
 *   IN_STOCK NUMBER(10),
 *   PRIMARY KEY (GIFT_ID)
 * );
 *
 * CREATE TABLE ORDERS (
 *   ORDER_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
 *   CUSTOMER_ID NUMBER,
 *   GIFT_ID NUMBER,
 *   QUANTITY NUMBER,
 *   TOTAL_PRICE NUMBER(12,2),
 *   ORDER_DATE TIMESTAMP DEFAULT SYSTIMESTAMP,
 *   PRIMARY KEY (ORDER_ID),
 *   CONSTRAINT FK_ORDER_CUSTOMER FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
 *   CONSTRAINT FK_ORDER_GIFT FOREIGN KEY (GIFT_ID) REFERENCES GIFT(GIFT_ID)
 * );
 *
 */

import javax.jws.WebMethod;
import javax.jws.WebParam;
import javax.jws.WebService;
import javax.xml.ws.Endpoint;
import javax.xml.namespace.QName;
import javax.xml.ws.Service;
import java.net.URL;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;
import java.util.Objects;

// ==========================
// DTOs
// ==========================
class Customer {
    private Long customerId;
    private String name;
    private String email;

    public Customer() {}

    public Customer(Long customerId, String name, String email) {
        this.customerId = customerId;
        this.name = name;
        this.email = email;
    }

    public Long getCustomerId() { return customerId; }
    public void setCustomerId(Long customerId) { this.customerId = customerId; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    @Override
    public String toString() {
        return "Customer{" + "customerId=" + customerId + ", name='" + name + '\'' + ", email='" + email + '\'' + '}';
    }
}

class Gift {
    private Long giftId;
    private String name;
    private Double price;
    private Integer inStock;

    public Gift() {}

    public Gift(Long giftId, String name, Double price, Integer inStock) {
        this.giftId = giftId;
        this.name = name;
        this.price = price;
        this.inStock = inStock;
    }

    public Long getGiftId() { return giftId; }
    public void setGiftId(Long giftId) { this.giftId = giftId; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public Double getPrice() { return price; }
    public void setPrice(Double price) { this.price = price; }
    public Integer getInStock() { return inStock; }
    public void setInStock(Integer inStock) { this.inStock = inStock; }

    @Override
    public String toString() {
        return "Gift{" + "giftId=" + giftId + ", name='" + name + '\'' + ", price=" + price + ", inStock=" + inStock + '}';
    }
}

class OrderDTO {
    private Long orderId;
    private Long customerId;
    private Long giftId;
    private Integer quantity;
    private Double totalPrice;

    public OrderDTO() {}

    public OrderDTO(Long orderId, Long customerId, Long giftId, Integer quantity, Double totalPrice) {
        this.orderId = orderId;
        this.customerId = customerId;
        this.giftId = giftId;
        this.quantity = quantity;
        this.totalPrice = totalPrice;
    }

    public Long getOrderId() { return orderId; }
    public void setOrderId(Long orderId) { this.orderId = orderId; }
    public Long getCustomerId() { return customerId; }
    public void setCustomerId(Long customerId) { this.customerId = customerId; }
    public Long getGiftId() { return giftId; }
    public void setGiftId(Long giftId) { this.giftId = giftId; }
    public Integer getQuantity() { return quantity; }
    public void setQuantity(Integer quantity) { this.quantity = quantity; }
    public Double getTotalPrice() { return totalPrice; }
    public void setTotalPrice(Double totalPrice) { this.totalPrice = totalPrice; }

    @Override
    public String toString() {
        return "OrderDTO{" + "orderId=" + orderId + ", customerId=" + customerId + ", giftId=" + giftId + ", quantity=" + quantity + ", totalPrice=" + totalPrice + '}';
    }
}

// ==========================
// DAO (Oracle JDBC)
// ==========================
class OracleDAO {
    // Ajusta estos datos a tu entorno
    private static final String DRIVER = "oracle.jdbc.driver.OracleDriver";
    private static final String CONNECTION_STRING = "jdbc:oracle:thin:@localhost:1521:ORCL"; // Cambia si usas servicio name
    private static final String USER = "YOUR_USER"; // e.g., APP_USER
    private static final String PASS = "YOUR_PASS";

    public OracleDAO() {
        try {
            Class.forName(DRIVER);
        } catch (ClassNotFoundException e) {
            throw new RuntimeException("Oracle JDBC driver not found. A√±ade ojdbc jar al classpath.", e);
        }
    }

    private Connection getConnection() throws SQLException {
        return DriverManager.getConnection(CONNECTION_STRING, USER, PASS);
    }

    // Customer CRUD
    public Customer createCustomer(Customer c) throws SQLException {
        String sql = "INSERT INTO CUSTOMER(NAME, EMAIL) VALUES(?, ?)";
        String[] cols = {"CUSTOMER_ID"};
        try (Connection conn = getConnection(); PreparedStatement ps = conn.prepareStatement(sql, cols)) {
            ps.setString(1, c.getName());
            ps.setString(2, c.getEmail());
            ps.executeUpdate();
            try (ResultSet rs = ps.getGeneratedKeys()) {
                if (rs.next()) {
                    c.setCustomerId(rs.getLong(1));
                }
            }
        }
        return c;
    }

    public Customer findCustomerById(Long id) throws SQLException {
        String sql = "SELECT CUSTOMER_ID, NAME, EMAIL FROM CUSTOMER WHERE CUSTOMER_ID = ?";
        try (Connection conn = getConnection(); PreparedStatement ps = conn.prepareStatement(sql)) {
            ps.setLong(1, id);
            try (ResultSet rs = ps.executeQuery()) {
                if (rs.next()) {
                    return new Customer(rs.getLong("CUSTOMER_ID"), rs.getString("NAME"), rs.getString("EMAIL"));
                }
            }
        }
        return null;
    }

    public List<Customer> listCustomers() throws SQLException {
        List<Customer> out = new ArrayList<>();
        String sql = "SELECT CUSTOMER_ID, NAME, EMAIL FROM CUSTOMER ORDER BY CUSTOMER_ID";
        try (Connection conn = getConnection(); PreparedStatement ps = conn.prepareStatement(sql); ResultSet rs = ps.executeQuery()) {
            while (rs.next()) {
                out.add(new Customer(rs.getLong("CUSTOMER_ID"), rs.getString("NAME"), rs.getString("EMAIL")));
            }
        }
        return out;
    }

    // Gift CRUD
    public Gift createGift(Gift g) throws SQLException {
        String sql = "INSERT INTO GIFT(NAME, PRICE, IN_STOCK) VALUES(?, ?, ?)";
        String[] cols = {"GIFT_ID"};
        try (Connection conn = getConnection(); PreparedStatement ps = conn.prepareStatement(sql, cols)) {
            ps.setString(1, g.getName());
            ps.setDouble(2, g.getPrice());
            ps.setInt(3, g.getInStock());
            ps.executeUpdate();
            try (ResultSet rs = ps.getGeneratedKeys()) {
                if (rs.next()) g.setGiftId(rs.getLong(1));
            }
        }
        return g;
    }

    public Gift findGiftById(Long id) throws SQLException {
        String sql = "SELECT GIFT_ID, NAME, PRICE, IN_STOCK FROM GIFT WHERE GIFT_ID = ?";
        try (Connection conn = getConnection(); PreparedStatement ps = conn.prepareStatement(sql)) {
            ps.setLong(1, id);
            try (ResultSet rs = ps.executeQuery()) {
                if (rs.next()) return new Gift(rs.getLong("GIFT_ID"), rs.getString("NAME"), rs.getDouble("PRICE"), rs.getInt("IN_STOCK"));
            }
        }
        return null;
    }

    public List<Gift> listGifts() throws SQLException {
        List<Gift> out = new ArrayList<>();
        String sql = "SELECT GIFT_ID, NAME, PRICE, IN_STOCK FROM GIFT ORDER BY GIFT_ID";
        try (Connection conn = getConnection(); PreparedStatement ps = conn.prepareStatement(sql); ResultSet rs = ps.executeQuery()) {
            while (rs.next()) out.add(new Gift(rs.getLong("GIFT_ID"), rs.getString("NAME"), rs.getDouble("PRICE"), rs.getInt("IN_STOCK")));
        }
        return out;
    }

    // Orders
    public OrderDTO createOrder(OrderDTO order) throws SQLException {
        // Reduce stock and insert order in a transaction
        String updateStock = "UPDATE GIFT SET IN_STOCK = IN_STOCK - ? WHERE GIFT_ID = ? AND IN_STOCK >= ?";
        String insertOrder = "INSERT INTO ORDERS(CUSTOMER_ID, GIFT_ID, QUANTITY, TOTAL_PRICE) VALUES(?, ?, ?, ?)";
        String[] cols = {"ORDER_ID"};

        try (Connection conn = getConnection()) {
            conn.setAutoCommit(false);
            try (PreparedStatement pst = conn.prepareStatement(updateStock)) {
                pst.setInt(1, order.getQuantity());
                pst.setLong(2, order.getGiftId());
                pst.setInt(3, order.getQuantity());
                int rows = pst.executeUpdate();
                if (rows == 0) {
                    conn.rollback();
                    throw new SQLException("Stock insuficiente o regalo no existe");
                }
            }
            try (PreparedStatement psi = conn.prepareStatement(insertOrder, cols)) {
                psi.setLong(1, order.getCustomerId());
                psi.setLong(2, order.getGiftId());
                psi.setInt(3, order.getQuantity());
                psi.setDouble(4, order.getTotalPrice());
                psi.executeUpdate();
                try (ResultSet rs = psi.getGeneratedKeys()) {
                    if (rs.next()) order.setOrderId(rs.getLong(1));
                }
            }
            conn.commit();
        }
        return order;
    }

    public List<OrderDTO> listOrders() throws SQLException {
        List<OrderDTO> out = new ArrayList<>();
        String sql = "SELECT ORDER_ID, CUSTOMER_ID, GIFT_ID, QUANTITY, TOTAL_PRICE FROM ORDERS ORDER BY ORDER_ID";
        try (Connection conn = getConnection(); PreparedStatement ps = conn.prepareStatement(sql); ResultSet rs = ps.executeQuery()) {
            while (rs.next()) {
                out.add(new OrderDTO(rs.getLong("ORDER_ID"), rs.getLong("CUSTOMER_ID"), rs.getLong("GIFT_ID"), rs.getInt("QUANTITY"), rs.getDouble("TOTAL_PRICE")));
            }
        }
        return out;
    }
}

// ==========================
// SOAP Service Interface
// ==========================
@WebService(name = "NavidadService", targetNamespace = "http://navidad.example.com/")
interface NavidadService {

    @WebMethod
    Customer createCustomer(@WebParam(name = "name") String name, @WebParam(name = "email") String email);

    @WebMethod
    List<Customer> listCustomers();

    @WebMethod
    Gift createGift(@WebParam(name = "name") String name, @WebParam(name = "price") double price, @WebParam(name = "inStock") int inStock);

    @WebMethod
    List<Gift> listGifts();

    @WebMethod
    OrderDTO createOrder(@WebParam(name = "customerId") long customerId, @WebParam(name = "giftId") long giftId, @WebParam(name = "quantity") int quantity);

    @WebMethod
    List<OrderDTO> listOrders();
}

// ==========================
// SOAP Service Implementation
// ==========================
@WebService(endpointInterface = "NavidadService", serviceName = "NavidadService")
class NavidadServiceImpl implements NavidadService {

    private OracleDAO dao = new OracleDAO();

    @Override
    public Customer createCustomer(String name, String email) {
        try {
            Customer c = new Customer(null, name, email);
            return dao.createCustomer(c);
        } catch (SQLException e) {
            throw new RuntimeException("Error creando cliente: " + e.getMessage(), e);
        }
    }

    @Override
    public List<Customer> listCustomers() {
        try {
            return dao.listCustomers();
        } catch (SQLException e) {
            throw new RuntimeException("Error listando clientes: " + e.getMessage(), e);
        }
    }

    @Override
    public Gift createGift(String name, double price, int inStock) {
        try {
            Gift g = new Gift(null, name, price, inStock);
            return dao.createGift(g);
        } catch (SQLException e) {
            throw new RuntimeException("Error creando regalo: " + e.getMessage(), e);
        }
    }

    @Override
    public List<Gift> listGifts() {
        try {
            return dao.listGifts();
        } catch (SQLException e) {
            throw new RuntimeException("Error listando regalos: " + e.getMessage(), e);
        }
    }

    @Override
    public OrderDTO createOrder(long customerId, long giftId, int quantity) {
        try {
            Gift gift = dao.findGiftById(giftId);
            if (gift == null) throw new RuntimeException("Regalo no encontrado");
            double total = Objects.requireNonNull(gift).getPrice() * quantity;
            OrderDTO order = new OrderDTO(null, customerId, giftId, quantity, total);
            return dao.createOrder(order);
        } catch (SQLException e) {
            throw new RuntimeException("Error creando orden: " + e.getMessage(), e);
        }
    }

    @Override
    public List<OrderDTO> listOrders() {
        try {
            return dao.listOrders();
        } catch (SQLException e) {
            throw new RuntimeException("Error listando ordenes: " + e.getMessage(), e);
        }
    }
}

// ==========================
// Endpoint publisher (para pruebas locales)
// ==========================
class EndpointPublisher {
    public static void main(String[] args) {
        String url = "http://localhost:8080/navidadService";
        System.out.println("Publicando servicio SOAP en: " + url + "?wsdl");
        NavidadServiceImpl impl = new NavidadServiceImpl();
        Endpoint.publish(url, impl);
        System.out.println("Servicio publicado. Presiona Ctrl+C para detener.");
    }
}

// ==========================
// Cliente ejemplo (consumo del servicio publicado localmente)
// ==========================
class NavidadClient {
    public static void main(String[] args) throws Exception {
        // Ajustar seg√∫n d√≥nde publiques el servicio
        URL wsdlURL = new URL("http://localhost:8080/navidadService?wsdl");
        QName SERVICE_NAME = new QName("http://navidad.example.com/", "NavidadService");
        QName PORT_NAME = new QName("http://navidad.example.com/", "NavidadServicePort");

        Service service = Service.create(wsdlURL, SERVICE_NAME);
        // A partir del Service obtienes el proxy implementando la interfaz
        NavidadService proxy = service.getPort(NavidadService.class);

        // Crear cliente
        Customer c = proxy.createCustomer("Juan Perez", "juan@example.com");
        System.out.println("Cliente creado: " + c);

        // Crear regalos
        Gift g1 = proxy.createGift("Mu√±eco de Nieve", 29.99, 50);
        Gift g2 = proxy.createGift("Caja de Dulces Navide√±os", 15.5, 100);
        System.out.println("Regalos creados: " + g1 + ", " + g2);

        // Listar
        System.out.println("Clientes: " + proxy.listCustomers());
        System.out.println("Regalos: " + proxy.listGifts());

        // Hacer orden
        OrderDTO o = proxy.createOrder(c.getCustomerId(), g1.getGiftId(), 2);
        System.out.println("Orden creada: " + o);

        System.out.println("Ordenes: " + proxy.listOrders());
    }
}

/*
 * Instrucciones r√°pidas para IntelliJ:
 * 1) Crea un proyecto Java (SDK 8 o 11+). Si usas Java 11+, a√±ade Metro (JAX-WS RI) como dependencia.
 *    Ejemplo (Maven):
 *
 *    <dependencies>
 *      <!-- Metro (JAX-WS RI) para Java 11+ -->
 *      <dependency>
 *        <groupId>com.sun.xml.ws</groupId>
 *        <artifactId>rt</artifactId>
 *        <version>2.3.3</version>
 *      </dependency>
 *      <!-- Oracle JDBC (no est√° en Maven Central) - a√±ade ojdbc jar manualmente -->
 *    </dependencies>
 *
 * 2) Copia este archivo como NavidadSoapService.java dentro de src/main/java.
 * 3) Ajusta OracleDAO.CONNECTION_STRING, USER y PASS.
 * 4) Ejecuta EndpointPublisher.main para publicar el servicio localmente.
 * 5) En otra ejecuci√≥n, ejecuta NavidadClient.main para consumir el servicio.
 *
 * Limitaciones y recomendaciones:
 * - Este ejemplo publica un endpoint simple con Endpoint.publish, √∫til para pruebas.
 * - Para producci√≥n, implementa en un servidor de aplicaciones, a√±ade autenticaci√≥n,
 *   paginaci√≥n, validaci√≥n y manejo de errores m√°s robusto.
 * - Maneja la liberaci√≥n de recursos y timeouts adecuadamente.
 */
```

------------------------------------------------------------------------

## ‚ñ∂ C√≥mo Ejecutarlo en IntelliJ

### 1Ô∏è‚É£ Crear proyecto Java (8 u 11+)

Si usas Java 11+, a√±ade Metro + ojdbc.

### 2Ô∏è‚É£ Copiar el archivo

Gu√°rdalo como:

    src/main/java/NavidadSoapService.java

### 3Ô∏è‚É£ Publicar el servicio

Ejecutar:

    EndpointPublisher.main()

Esto expone:

    http://localhost:8080/navidadService?wsdl

### 4Ô∏è‚É£ Probar con el cliente

Ejecutar:

    NavidadClient.main()

------------------------------------------------------------------------

## üì° Ejemplo de Uso desde el Cliente

El cliente incluido ejecuta:

-   Crear un cliente\
-   Crear regalos\
-   Listar datos\
-   Crear orden\
-   Listar √≥rdenes

------------------------------------------------------------------------

## üìÇ Contenido del Archivo Fuente

El documento completo de c√≥digo est√° incluido en el cuerpo original que
proporcionaste.\
Puedes integrarlo directamente en tu proyecto IntelliJ.

------------------------------------------------------------------------

## üéÑ Notas Finales

Este ejemplo est√° dise√±ado para:

-   pruebas de laboratorio,
-   demostraciones educativas,
-   entornos locales.

Para producci√≥n:

-   separa el proyecto en m√≥dulos,
-   agrega autenticaci√≥n,
-   configura un servidor de aplicaciones,
-   implementa manejo avanzado de errores y logs.

------------------------------------------------------------------------
